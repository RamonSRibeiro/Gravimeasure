{% extends 'base.html' %}

{% block title %}Importar Dados - {{ block.super }}{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 40px auto; padding: 0 20px;">
    <div style="background: white; padding: 30px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

        <h2>Importar Medições Gravimétricas</h2>

        <!-- ✅ Exibir mensagens de erro/sucesso -->
        {% if messages %}
            <div style="margin: 20px 0;">
                {% for message in messages %}
                    <div style="
                        padding: 12px;
                        border-radius: 4px;
                        margin-bottom: 10px;
                        font-weight: 600;
                        background-color: {% if message.tags == 'error' %}#f8d7da{% else %}#d4edda{% endif %};
                        color: {% if message.tags == 'error' %}#721c24{% else %}#155724{% endif %};
                        border: 1px solid {% if message.tags == 'error' %}#f5c6cb{% else %}#c3e6cb{% endif %};
                    ">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- ✅ Instruções -->
        <div style="background-color: #e9ecef; padding: 15px; border-radius: 4px; margin-bottom: 25px; font-size: 0.9rem;">
            <h4 style="margin-top: 0;">Instruções para o Arquivo:</h4>
            <p>O arquivo Excel (.xlsx) deve conter as seguintes colunas exatamente como descritas:</p>

            <code>
                codigo_estacao, nome_estacao, latitude, longitude, valor_gravidade, data_medicao
            </code>

            <p style="margin-top: 10px;">
                Gravidade deve estar em <strong>mGal</strong>, por exemplo:
                <code>978032.5</code>
            </p>
        </div>

        <!-- ✅ Formulário único correto -->
        <form method="post" enctype="multipart/form-data" id="importForm">
            {% csrf_token %}

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 700;">
                    Selecione o arquivo Excel:
                </label>

                <!-- ✅ Campo deve se chamar "arquivo" -->
                <input type="file"
                       name="arquivo"
                       accept=".xlsx"
                       required
                       style="width: 100%; padding: 10px; border: 1px solid var(--border-gray); border-radius: 4px;">
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit"
                        style="padding: 10px 25px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 700;">
                    Importar Excel
                </button>

                <a href="{% url 'medicoes:medicao_lista' %}"
                   style="padding: 10px 20px; background-color: #666; color: white; text-decoration: none; border-radius: 4px;">
                    Cancelar
                </a>
            </div>
        </form>

    </div>
</div>

<!-- ✅ Spinner -->
<script>
    document.getElementById('importForm').addEventListener('submit', function() {
        if (document.getElementById('spinner')) {
            document.getElementById('spinner').classList.add('show');
            document.getElementById('spinnerOverlay').classList.add('show');
        }
    });
</script>
{% endblock %}
